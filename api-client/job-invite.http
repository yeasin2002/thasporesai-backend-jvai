### Job Invite API Tests
### Base URL
@baseUrl = http://localhost:4000
@customerToken = YOUR_CUSTOMER_TOKEN_HERE
@contractorToken = YOUR_CONTRACTOR_TOKEN_HERE
@jobId = YOUR_JOB_ID_HERE
@contractorId = YOUR_CONTRACTOR_ID_HERE
@inviteId = YOUR_INVITE_ID_HERE

### ============================================
### CUSTOMER ENDPOINTS
### ============================================

### 1. Get Available Contractors for Job (NEW - Excludes applied & invited)
GET {{baseUrl}}/api/job-invite/available/{{jobId}}
Authorization: Bearer {{customerToken}}

### 2. Get Available Contractors with Search
GET {{baseUrl}}/api/job-invite/available/{{jobId}}?search=plumbing
Authorization: Bearer {{customerToken}}

### 3. Get Available Contractors with Category Filter
GET {{baseUrl}}/api/job-invite/available/{{jobId}}?category=CATEGORY_ID
Authorization: Bearer {{customerToken}}

### 4. Get Available Contractors with Location Filter
GET {{baseUrl}}/api/job-invite/available/{{jobId}}?location=LOCATION_ID
Authorization: Bearer {{customerToken}}

### 5. Get Available Contractors with Budget Filter
GET {{baseUrl}}/api/job-invite/available/{{jobId}}?minBudget=50&maxBudget=150
Authorization: Bearer {{customerToken}}

### 6. Get Available Contractors with Combined Filters
GET {{baseUrl}}/api/job-invite/available/{{jobId}}?search=repair&category=CATEGORY_ID&location=LOCATION_ID&page=1&limit=10
Authorization: Bearer {{customerToken}}

### 7. Send Invite to Contractor
POST {{baseUrl}}/api/job-invite/send/{{jobId}}
Content-Type: application/json
Authorization: Bearer {{customerToken}}

{
  "contractorId": "{{contractorId}}",
  "message": "I'd like to invite you to work on this project. Your skills match perfectly!"
}

### 8. Send Invite to Contractor Who Already Applied (Now Allowed!)
POST {{baseUrl}}/api/job-invite/send/{{jobId}}
Content-Type: application/json
Authorization: Bearer {{customerToken}}

{
  "contractorId": "CONTRACTOR_WHO_APPLIED_ID",
  "message": "I saw your application and would like to discuss further..."
}

### 9. Get Sent Invites (All)
GET {{baseUrl}}/api/job-invite/sent
Authorization: Bearer {{customerToken}}

### 10. Get Sent Invites (Filtered by Job)
GET {{baseUrl}}/api/job-invite/sent?jobId={{jobId}}
Authorization: Bearer {{customerToken}}

### 11. Get Sent Invites (Filtered by Status)
GET {{baseUrl}}/api/job-invite/sent?status=pending
Authorization: Bearer {{customerToken}}

### 12. Get Sent Invites (Paginated)
GET {{baseUrl}}/api/job-invite/sent?page=1&limit=5
Authorization: Bearer {{customerToken}}

### 13. Cancel Invite
DELETE {{baseUrl}}/api/job-invite/{{inviteId}}
Authorization: Bearer {{customerToken}}

### ============================================
### CONTRACTOR ENDPOINTS
### ============================================

### 14. Get Received Invites (All)
GET {{baseUrl}}/api/job-invite/received
Authorization: Bearer {{contractorToken}}

### 15. Get Received Invites (Filtered by Status)
GET {{baseUrl}}/api/job-invite/received?status=pending
Authorization: Bearer {{contractorToken}}

### 16. Get Received Invites (Paginated)
GET {{baseUrl}}/api/job-invite/received?page=1&limit=5
Authorization: Bearer {{contractorToken}}

### 17. Accept Invite
PATCH {{baseUrl}}/api/job-invite/{{inviteId}}/accept
Authorization: Bearer {{contractorToken}}

### 18. Reject Invite (Without Reason)
PATCH {{baseUrl}}/api/job-invite/{{inviteId}}/reject
Content-Type: application/json
Authorization: Bearer {{contractorToken}}

{}

### 19. Reject Invite (With Reason)
PATCH {{baseUrl}}/api/job-invite/{{inviteId}}/reject
Content-Type: application/json
Authorization: Bearer {{contractorToken}}

{
  "rejectionReason": "Not available at this time. Thank you for considering me!"
}

### ============================================
### SHARED ENDPOINTS
### ============================================

### 20. Get Invite Details (Customer)
GET {{baseUrl}}/api/job-invite/{{inviteId}}
Authorization: Bearer {{customerToken}}

### 21. Get Invite Details (Contractor)
GET {{baseUrl}}/api/job-invite/{{inviteId}}
Authorization: Bearer {{contractorToken}}

### ============================================
### ERROR CASES
### ============================================

### 22. Get Available Contractors Without Auth (Should fail with 401)
GET {{baseUrl}}/api/job-invite/available/{{jobId}}

### 23. Send Invite Without Auth (Should fail with 401)
POST {{baseUrl}}/api/job-invite/send/{{jobId}}
Content-Type: application/json

{
  "contractorId": "{{contractorId}}",
  "message": "Test"
}

### 24. Send Duplicate Invite (Should fail with 400)
POST {{baseUrl}}/api/job-invite/send/{{jobId}}
Content-Type: application/json
Authorization: Bearer {{customerToken}}

{
  "contractorId": "{{contractorId}}",
  "message": "Duplicate invite test"
}

### 25. Accept Already Processed Invite (Should fail with 400)
PATCH {{baseUrl}}/api/job-invite/{{inviteId}}/accept
Authorization: Bearer {{contractorToken}}

### 26. Cancel Already Processed Invite (Should fail with 400)
DELETE {{baseUrl}}/api/job-invite/{{inviteId}}
Authorization: Bearer {{customerToken}}

### 27. Contractor Tries to Send Invite (Should fail with 403)
POST {{baseUrl}}/api/job-invite/send/{{jobId}}
Content-Type: application/json
Authorization: Bearer {{contractorToken}}

{
  "contractorId": "{{contractorId}}",
  "message": "Test"
}

### 28. Customer Tries to Accept Invite (Should fail with 403)
PATCH {{baseUrl}}/api/job-invite/{{inviteId}}/accept
Authorization: Bearer {{customerToken}}

### 29. Get Available Contractors for Someone Else's Job (Should fail with 403)
GET {{baseUrl}}/api/job-invite/available/SOMEONE_ELSES_JOB_ID
Authorization: Bearer {{customerToken}}

### ============================================
### TESTING NEW BEHAVIOR
### ============================================

### 30. Verify: Contractor Applies to Job
POST {{baseUrl}}/api/job-request/apply/{{jobId}}
Content-Type: application/json
Authorization: Bearer {{contractorToken}}

{
  "message": "I'm interested in this job"
}

### 31. Verify: Customer Can Still Invite That Contractor (NEW BEHAVIOR)
POST {{baseUrl}}/api/job-invite/send/{{jobId}}
Content-Type: application/json
Authorization: Bearer {{customerToken}}

{
  "contractorId": "{{contractorId}}",
  "message": "I saw your application. Let's discuss!"
}

### 32. Verify: Contractor No Longer Appears in Available List
GET {{baseUrl}}/api/job-invite/available/{{jobId}}
Authorization: Bearer {{customerToken}}
