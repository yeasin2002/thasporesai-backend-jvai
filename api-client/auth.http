### JobSphere Authentication API Tests
### Base URL
@baseUrl = http://localhost:4000
@contentType = application/json

### User Credentials
@customerEmail = customer@g.com
@contractorEmail = contractor@g.com
@adminEmail = admin@g.com
@password = 123456
    
### Variables (update after each request)
@accessToken = 
@refreshToken =

###############################################
# 1. Register New User (Customer)
###############################################
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "full_name": "Customer User",
  "email": "{{customerEmail}}",
  "password": "{{password}}",
  "role": "customer",
  "phone": "+1234567890"
}

###############################################
# 2. Register New User (Contractor)
###############################################
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "full_name": "Contractor User",
  "email": "{{contractorEmail}}",
  "password": "{{password}}",
  "role": "contractor",
  "phone": "+0987654321"
}

###############################################
# 3. Register New User (Admin)
###############################################
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "full_name": "Admin User",
  "email": "{{adminEmail}}",
  "password": "{{password}}",
  "role": "admin",
  "phone": "+1122334455"
}

###############################################
# 4.1. Login as Customer
###############################################
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "email": "{{customerEmail}}",
  "password": "{{password}}"
}


###############################################
# 4.2. Login as Contractor
###############################################
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "email": "{{contractorEmail}}",
  "password": "{{password}}"
}


###############################################
# 4.3. Login as Admin
############################################### 
POST {{baseUrl}}/api/admin/auth/login
Content-Type: {{contentType}}

{
  "email": "{{adminEmail}}",
  "password": "{{password}}"
}


###############################################
# 5. Forgot Password (Request OTP) - Customer
###############################################
POST {{baseUrl}}/api/auth/forgot-password
Content-Type: {{contentType}}

{
  "email": "{{customerEmail}}"
}

###############################################
# 6. Reset Password (Use OTP from console) - Customer
###############################################
POST {{baseUrl}}/api/auth/reset-password
Content-Type: {{contentType}}

{
  "email": "{{customerEmail}}",
  "otp": "1234",
  "newPassword": "{{password}}"
}

###############################################
# 7. Refresh Access Token
###############################################
POST {{baseUrl}}/api/auth/refresh
Content-Type: {{contentType}}

{
  "refreshToken": "{{refreshToken}}"
}

###############################################
# 8. Get Current User (Protected Route)
###############################################
GET {{baseUrl}}/api/auth/me
Authorization: Bearer {{accessToken}}

###############################################
# Error Cases
###############################################

### Register with existing email
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "full_name": "Duplicate User",
  "email": "{{customerEmail}}",
  "password": "{{password}}",
  "role": "customer"
}

### Login with wrong password
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "email": "{{customerEmail}}",
  "password": "wrongpassword"
}

### Login with non-existent email
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "email": "notfound@example.com",
  "password": "{{password}}"
}

### Reset password with invalid OTP
POST {{baseUrl}}/api/auth/reset-password
Content-Type: {{contentType}}

{
  "email": "{{customerEmail}}",
  "otp": "0000",
  "newPassword": "newpassword123"
}

### Refresh with invalid token
POST {{baseUrl}}/api/auth/refresh
Content-Type: {{contentType}}

{
  "refreshToken": "invalid-token"
}

### Access protected route without token
GET {{baseUrl}}/api/auth/me

###############################################
# Validation Error Cases
###############################################

### Register with invalid email
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "full_name": "Test User",
  "email": "invalid-email",
  "password": "{{password}}",
  "role": "customer"
}

### Register with short password
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "full_name": "Test User",
  "email": "test@example.com",
  "password": "123",
  "role": "customer"
}

### Login with missing fields
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "email": "{{customerEmail}}"
}

### Reset password with invalid OTP length
POST {{baseUrl}}/api/auth/reset-password
Content-Type: {{contentType}}

{
  "email": "{{customerEmail}}",
  "otp": "123",
  "newPassword": "{{password}}"
}
